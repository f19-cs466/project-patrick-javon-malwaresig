// CS466 Project
// By Javon Kitson, Patrick Sacchet
// Due November 22nd at Midnight

#include <stdio.h>  
#include <unistd.h>  
#include <stdlib.h>
#include <string.h>
#include <sys/types.h>
#include <sys/stat.h>

//int OUTPUT = 1; //output will print unless otherwise specified
int RUNNING = 1;
const int NUM_DIRECTORIES = 5;

// Simple function to print all options for the user
// Params - None
// Returns - None
void print_options()
{
    printf("Options:\n"
        "   -s, --scan: Run a scan\n"
        "   -h, --help: display what you are reading now\n"
        "   -q, --quiet: output nothing\n"
        "   -e, --exit: Exit program\n" );
  return;
}

// Function will continue to ask user for valid input
// Params - None
// Returns -  input - the input given by the user                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             
int command_prompt()
{
  int input, result;
  printf("malwaresig > ");
  result = scanf("%d", &input);
  // While the user has not given valid input, we keep running
  while(RUNNING)
  {
    // Check the return value of scanf to ensure we can read it
    if(result == 0 || result == EOF)
    {
      printf("Something went wrong, please try again\n");
      printf("malwaresig > ");
      result = scanf("%d", &input);
    }
    // Check to see the user gave us valid input that is a option, if not, print the options
    else if(input != 0 && input != 1 && input != 2)
    {
      printf("Invalid input, here's some help:\n");
      print_options();
      printf("malwaresig > ");
      result = scanf("%d", &input);
    }
    // Otherwise the user gave us valid input so return their input
    else
    {
      RUNNING = 0;
    }
  }
  RUNNING = 1;
  return input;
}

// int get_input(int opt){
//     	// put ':' in the starting of the 
// 	// string so that program can 
// 	//distinguish between '?' and ':' 
// 	while((opt = getopt(argc, argv, ":if:shqe")) != -1) 
// 	{ 
// 		switch(opt) 
// 		{ 
// 			case 's':
//                 printf("option: %c\n", opt); 
// 				break; 
// 			case 'h':
//                 // print the options for the user
//                 print_options();
// 				break;
// 			case 'q':
//                 print_options();
// 				break;
// 			case 'e':
//                 return 0;
// 				break; 
// 			case 'f': 
// 				printf("filename: %s\n", optarg); 
// 				break; 
// 			case ':': 
// 				printf("option needs a value\n"); 
// 				break; 
// 			case '?': 
// 				printf("unknown option: %c\n", optopt); 
// 				break; 
// 		} 
// 	} 
	
// 	// optind is for the extra arguments 
// 	// which are not parsed 
// 	for(; optind < argc; optind++){	 
// 		printf("unknown arguments: %s\n", argv[optind]);
//         printf("starting command line");
// 	}
//     return 0;
// }

// Function will print a logo for our program
// Params - None
// Returns - None
void print_logo()
{
  // Print our cool logo (thanks Javon :))
  printf(R"EOF(
      ███╗   ███╗ █████╗ ██╗     ██╗    ██╗ █████╗ ██████╗ ███████╗███████╗██╗ ██████╗
      ████╗ ████║██╔══██╗██║     ██║    ██║██╔══██╗██╔══██╗██╔════╝██╔════╝██║██╔════╝
      ██╔████╔██║███████║██║     ██║ █╗ ██║███████║██████╔╝█████╗  ███████╗██║██║  ███╗
      ██║╚██╔╝██║██╔══██║██║     ██║███╗██║██╔══██║██╔══██╗██╔══╝  ╚════██║██║██║   ██║
      ██║ ╚═╝ ██║██║  ██║███████╗╚███╔███╔╝██║  ██║██║  ██║███████╗███████║██║╚██████╔╝
      ╚═╝     ╚═╝╚═╝  ╚═╝╚══════╝ ╚══╝╚══╝ ╚═╝  ╚═╝╚═╝  ╚═╝╚══════╝╚══════╝╚═╝ ╚═════╝
  )EOF");
  printf("\n");
  return;
}

// Function will create test directories with test files so we can scan them
// Params - None
// Returns - None
void create_directories()
{
  // Initialize array of test directories (still need to set size)
  char *test_dir[] = {"test_dir1", "test_dir2", "test_dir3", "test_dir4", "test_dir5"};
  int result;
  for(int i = 0; i < NUM_DIRECTORIES; i++)
  {
    // 0777 is the access code for all users to be able to access
    result = mkdir(test_dir[i], 0777);
    // Directory made successfully
    if(!result)
    {
      printf("Directory created successfully\n");
    }
    // We failed in creating the directory
    else
    {
      printf("Looks like the directory might already exist?\n");
    }
  }
  return;
}

// Main function
int main(int argc, char *argv[])
{
    //Get input from the user
    int opt;
    //get_input(opt);

    // Print the logo of course
    print_logo();

      	// put ':' in the starting of the 
	// string so that program can 
	//distinguish between '?' and ':' 
	while((opt = getopt(argc, argv, ":if:shqe")) != -1) 
	{ 
		switch(opt) 
		{ 
			case 's':
                printf("option: %c\n", opt); 
				break; 
			case 'h':
                // print the options for the user
                print_options();
				break;
			case 'q':
                print_options();
				break;
			case 'e':
                return 0;
				break; 
			case 'f': 
				printf("filename: %s\n", optarg); 
				break; 
			case ':': 
				printf("option needs a value\n"); 
				break; 
			case '?': 
				printf("unknown option: %c\n", optopt); 
				break; 
		} 
	} 
	
	// optind is for the extra arguments 
	// which are not parsed 
	for(; optind < argc; optind++){	 
		printf("unknown arguments: %s\n", argv[optind]);
        printf("starting command line");
	}


//   while(RUNNING)
//   {
//     // Check to see if user wants to exit, otherwise perform the desired function
//     if(input == 0)
//     {
//         exit(-1);
//     }
//     else if(input == 1)
//     {
    
//       // Call print rules function
//     }
//     // User must have input 2
//     else
//     {
//       create_directories();
//       input = get_input();
//       // Call scan function
//     }
//   }


    // printf("Options:\n"
    //     "   -0: Exit program\n" 
    //     "   -1: Print rules\n" // opposite of quiet
    //     "   -2: Run a scan\n"
    //     "   -h, --help: display what you are reading now\n"
    //     "   -q, --quiet: output nothing\n");

//     //char input[30];
//     //strcpy(input, argv[1]);

//     // if( strcmp(input,"-h") == 0){
//     //     printf("This is the help for MALWARESIG\n"
//     //         "Options are:\n"
//     //         "    -h: display what you are reading now\n"
//     //         "    -q: output nothing\n");
//     //     return 0;
//     // }

//    // if(strcmp(input, "-q") == 0){
//    //         OUTPUT = 0;
//             //call function to do things
//     }else if (strcmp(string, "xxx") == 0)
//     {
//         // do something else
//     }
//      more else if clauses
//      */
//     else  default:
//     {
//         printf("Command not found: Use -h for help\n");
//     }

//    if(OUTPUT){ printf("Analysing: %s\n", argv[1]);}

    return 0;
}
